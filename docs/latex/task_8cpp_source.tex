\hypertarget{task_8cpp_source}{}\doxysection{task.\+cpp}
\label{task_8cpp_source}\index{src/sched/task.cpp@{src/sched/task.cpp}}
\mbox{\hyperlink{task_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{task_8h}{task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00003}\mbox{\hyperlink{namespace_e_a_r_1_1_schedule_a6e548ce80b554f0a5d81048d6fdf0d91}{00003}} \textcolor{keywordtype}{void} *\mbox{\hyperlink{namespace_e_a_r_1_1_schedule_a6e548ce80b554f0a5d81048d6fdf0d91}{EAR::Schedule::\_\_makeParallel}}(\textcolor{keywordtype}{void} *args) \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00004}00004   \textcolor{keywordflow}{if} (\textcolor{keyword}{nullptr} == args) \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00005}00005     spdlog::critical(\textcolor{stringliteral}{"{}could not start task, invalid task instance"{}});}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00006}00006     \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00007}00007   \}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00008}00008   }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00009}00009   \mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task}{EAR::Schedule::Task}} *task = \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task}{EAR::Schedule::Task}} *\textcolor{keyword}{>}(args);}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00010}00010     }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00011}00011   \textcolor{keywordflow}{if} (\textcolor{keyword}{nullptr} == task) \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00012}00012     spdlog::critical(\textcolor{stringliteral}{"{}could not start task, because conversion failed"{}});}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00013}00013   \}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00014}00014   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00015}00015     task-\/>\mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task_ab67fb3675f9975bf332ae3b1ad1987b4}{execute}}();}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00016}00016   \}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00017}00017     }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00018}00018   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00019}00019 \}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00021}\mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task_a993e9146d72aa7f42ab6be98cbb554a4}{00021}} \mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task_a993e9146d72aa7f42ab6be98cbb554a4}{EAR::Schedule::Task::Task}}(\textcolor{keyword}{const} std::string \&name) : \mbox{\hyperlink{namespace_e_a_r}{EAR}}::Schedule::\mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_i_task}{ITask}}(name) \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00022}00022   pthread\_create(\&m\_task, \textcolor{keyword}{nullptr}, \mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task_aefc4f90ae9070653843d0b07360ffef2}{\_\_makeParallel}}, \textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00023}00023 \}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00025}\mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task_ad3b0df4e2d75d074538f3f19066bd3d6}{00025}} \mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task_ad3b0df4e2d75d074538f3f19066bd3d6}{EAR::Schedule::Task::\string~Task}}() \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00026}00026   pthread\_join(m\_task, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00027}00027 \}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00029}\mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task_ab67fb3675f9975bf332ae3b1ad1987b4}{00029}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_e_a_r_1_1_schedule_1_1_task_ab67fb3675f9975bf332ae3b1ad1987b4}{EAR::Schedule::Task::execute}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00030}00030   std::chrono::steady\_clock::time\_point begin;}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00031}00031   std::chrono::steady\_clock::time\_point end;}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00032}00032   std::chrono::microseconds elapsed;}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00034}00034   \textcolor{comment}{// while keyword is to prevent that any unwanted situation breaks blocking call}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00035}00035   \textcolor{keywordflow}{while} (0 != pthread\_cond\_wait(\&m\_start\_cond\_var, \&m\_start\_mutex));}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00036}00036   std::this\_thread::sleep\_for(std::chrono::microseconds(m\_offset));}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00037}00037     }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00038}00038   \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00039}00039     begin = std::chrono::steady\_clock::now();}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00040}00040     cycle();}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00041}00041     end = std::chrono::steady\_clock::now();}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00042}00042       }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00043}00043     elapsed = std::chrono::duration\_cast<std::chrono::microseconds>(end -\/ begin);}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00045}00045     \textcolor{keywordflow}{if} (elapsed <= m\_period) \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00046}00046       std::this\_thread::sleep\_for(std::chrono::microseconds(m\_period -\/ elapsed));}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00047}00047     \}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00048}00048     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00049}00049       spdlog::error(\textcolor{stringliteral}{"{}deadline missed for task \{\}"{}}, getName());}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00050}00050       std::this\_thread::sleep\_for(std::chrono::microseconds(m\_period -\/ (elapsed \% m\_period)));}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00051}00051     \}}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00052}00052   \} \textcolor{keywordflow}{while} (m\_is\_running);}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00054}00054   spdlog::debug(\textcolor{stringliteral}{"{}task \{\} function is over"{}}, getName());}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00055}00055     }
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00056}00056   \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{task_8cpp_source_l00057}00057 \}}

\end{DoxyCode}
